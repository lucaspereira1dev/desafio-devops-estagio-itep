# Define o contexto para eventos de I/O.
events {}

# Define o contexto para as diretivas HTTP.
http {
    #incluindo tipos MIME como .css, .js, etc
    include /etc/nginx/mime.types;
    # Define um servidor virtual.
    server {
        # O Nginx escutará na porta 80.
        listen 80;

        # Rota para a raiz (/)
        location / {
            # Retorna um HTML simples como página de boas-vindas
            return 200 '
                <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Bem-vindo!</title>
                    </head>

                    <body
                        style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; display: flex; justify-content: center; align-items: center; min-height: 100vh;">

                        <div
                            style="background-color: #ffffff; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; max-width: 500px; width: 90%;">

                            <h1 style="color: #2c3e50; margin-top: 0; font-weight: 300; font-size: 2em;">
                                Página Principal
                            </h1>

                            <p style="color: #555; line-height: 1.6; margin-bottom: 30px;">
                                Acesse as aplicações disponíveis abaixo:
                            </p>

                            <ul style="list-style-type: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 15px;">
                                    <a href="/app1/"
                                        style="display: inline-block; background-color: #007bff; color: #ffffff; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; transition: background-color 0.3s ease;">
                                        Aplicação 1
                                    </a>
                                </li>
                                <li>
                                    <a href="/app2/"
                                        style="display: inline-block; background-color: #28a745; color: #ffffff; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; transition: background-color 0.3s ease;">
                                        Aplicação 2
                                    </a>
                                </li>
                            </ul>

                        </div>

                    </body>

                    </html>
            ';
            add_header Content-Type text/html;
        }

        # Rota para /app1
        location /app1/static/ {
            alias /var/www/app1/static/;
        }

        # Captura todo o resto que começa com /app1/
        location /app1/ {
            proxy_pass http://app1:3031/;
        }

        # Rota para /app2
        location /app2/ {
            proxy_pass http://app2:3032/;
            
            # Habilita o suporte a WebSockets, que o Streamlit precisa para ser interativo
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_read_timeout 86400; #timeout para conexões longas
        }
    }
}